<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/neoremind/kraps-rpc#kraps-rpc" aria-hidden="true" class="anchor" id="user-content-kraps-rpc" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>kraps-rpc</h1> 
  <p><a href="https://travis-ci.org/neoremind/kraps-rpc" target="_blank"><img src="https://camo.githubusercontent.com/192153ab6ceb0f9ec0f950d2cdfca72c717b8a3c/68747470733a2f2f7472617669732d63692e6f72672f6e656f72656d696e642f6b726170732d7270632e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/neoremind/kraps-rpc.svg?branch=master" style="max-width:100%;"></a> <a href="https://maven-badges.herokuapp.com/maven-central/net.neoremind/kraps-rpc_2.11" target="_blank"><img src="https://camo.githubusercontent.com/5d05b801aae0886df98cc8bdf9470616a3b219ef/68747470733a2f2f6d6176656e2d6261646765732e6865726f6b756170702e636f6d2f6d6176656e2d63656e7472616c2f6e65742e6e656f72656d696e642f6b726170732d7270635f322e31312f62616467652e737667" alt="Maven Central" data-canonical-src="https://maven-badges.herokuapp.com/maven-central/net.neoremind/kraps-rpc_2.11/badge.svg" style="max-width:100%;"></a> <a href="https://codecov.io/gh/neoremind/kraps-rpc" target="_blank"><img src="https://camo.githubusercontent.com/f211b0c70d059f8dfd45f9363e6ff920f5db22bb/68747470733a2f2f636f6465636f762e696f2f67682f6e656f72656d696e642f6b726170732d7270632f6272616e63682f6d61737465722f67726170682f62616467652e737667" alt="codecov" data-canonical-src="https://codecov.io/gh/neoremind/kraps-rpc/branch/master/graph/badge.svg" style="max-width:100%;"></a> <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank"><img src="https://camo.githubusercontent.com/64d506383be67decddf8968e3b0072c3e9ba4a84/68747470733a2f2f696d672e736869656c64732e696f2f686578706d2f6c2f706c75672e737667" alt="Hex.pm" data-canonical-src="https://img.shields.io/hexpm/l/plug.svg" style="max-width:100%;"></a></p> 
  <p>Kraps-rpc is a RPC framework split from <a href="https://github.com/apache/spark" target="_blank">Spark</a>, you can regard it as <code>spark-rpc</code> with the word <em>spark</em> reversed.</p> 
  <p>This module is mainly for studying how RPC works in Spark, as people knows that Spark consists many distributed components, such as driver, master, executor, block manager, etc, and they communicate with each other through RPC. In Spark project the functionality is sealed in <code>Spark-core</code> module. Kraps-rpc separates the core RCP part from it, not including security and streaming download feature.</p> 
  <p>The module is based on Spark 2.1 version, which eliminate <a href="http://akka.io/" target="_blank">Akka</a> due to <a href="https://issues.apache.org/jira/browse/SPARK-5293" target="_blank">SPARK-5293</a>.</p> 
  <ul> 
   <li><a href="https://github.com/neoremind/kraps-rpc#0-dependency" target="_blank">0. Dependency</a></li> 
   <li><a href="https://github.com/neoremind/kraps-rpc#1-how-to-run" target="_blank">1. How to run</a> 
    <ul> 
     <li><a href="https://github.com/neoremind/kraps-rpc#11-create-an-endpoint" target="_blank">1.1 Create an endpoint</a></li> 
     <li><a href="https://github.com/neoremind/kraps-rpc#12-run-server" target="_blank">1.2 Run server</a></li> 
     <li><a href="https://github.com/neoremind/kraps-rpc#13-client-call" target="_blank">1.3 Client call</a></li> 
    </ul> </li> 
   <li><a href="https://github.com/neoremind/kraps-rpc#2-about-rpcconf" target="_blank">2. About RpcConf</a></li> 
   <li><a href="https://github.com/neoremind/kraps-rpc#3-more-examples" target="_blank">3. More examples</a></li> 
   <li><a href="https://github.com/neoremind/kraps-rpc#4-performance-test" target="_blank">4. Performance test</a> 
    <ul> 
     <li><a href="https://github.com/neoremind/kraps-rpc#41-test-environment" target="_blank">4.1 Test environment</a></li> 
     <li><a href="https://github.com/neoremind/kraps-rpc#42-test-case" target="_blank">4.2 Test case</a></li> 
     <li><a href="https://github.com/neoremind/kraps-rpc#43-test-result" target="_blank">4.3 Test result</a></li> 
    </ul> </li> 
   <li><a href="https://github.com/neoremind/kraps-rpc#5-dependency-tree" target="_blank">5. Dependency tree</a></li> 
  </ul> 
  <h2><a href="https://github.com/neoremind/kraps-rpc#0-dependency" aria-hidden="true" class="anchor" id="user-content-0-dependency" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>0. Dependency</h2> 
  <p>You can configure you project by including dependency from below, currently only work with <strong>scala 2.11</strong>.</p> 
  <p>Maven:</p> 
  <pre><code>&lt;dependency&gt;
    &lt;groupId&gt;net.neoremind&lt;/groupId&gt;
    &lt;artifactId&gt;kraps-rpc_2.11&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre> 
  <p>SBT:</p> 
  <pre><code>"net.neoremind" % "kraps-rpc_2.11" % "1.0.0"
</code></pre> 
  <p>To learn more dependencies, please go to <em>Dependency tree</em> section.</p> 
  <h2><a href="https://github.com/neoremind/kraps-rpc#1-how-to-run" aria-hidden="true" class="anchor" id="user-content-1-how-to-run" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>1. How to run</h2> 
  <p>The following examples can be found in <a href="https://github.com/neoremind/kraps-rpc/tree/master/kraps-rpc-example/src/main/scala" target="_blank">kraps-rpc-example</a></p> 
  <h3><a href="https://github.com/neoremind/kraps-rpc#11-create-an-endpoint" aria-hidden="true" class="anchor" id="user-content-11-create-an-endpoint" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>1.1 Create an endpoint</h3> 
  <p>Creating an endpoint which contains the business logic you would like to provide as a RPC service. Below shows a simple example of a hello world echo service.</p> 
  <pre><code>class HelloEndpoint(override val rpcEnv: RpcEnv) extends RpcEndpoint {

  override def onStart(): Unit = {
    println("start hello endpoint")
  }

  override def receiveAndReply(context: RpcCallContext): PartialFunction[Any, Unit] = {
    case SayHi(msg) =&gt; {
      println(s"receive $msg")
      context.reply(s"hi, $msg")
    }
    case SayBye(msg) =&gt; {
      println(s"receive $msg")
      context.reply(s"bye, $msg")
    }
  }

  override def onStop(): Unit = {
    println("stop hello endpoint")
  }
}


case class SayHi(msg: String)

case class SayBye(msg: String)

</code></pre> 
  <p><code>RpcEndpoint</code>&nbsp;is where to receive and handle requests, as <code>actor</code> notation in akka.&nbsp;<code>RpcEndpoint</code>&nbsp;does differentiate message <code>need-not-reply</code> from <code>need-reply</code>. Former one is much like UDP message (send and forget), latter one follows tcp way, waiting for one response.</p> 
  <pre><code>  /**
   * Process messages from [[RpcEndpointRef.send]] or [[RpcCallContext.reply)]]. If receiving a
   * unmatched message, [[SparkException]] will be thrown and sent to `onError`.
   */
  def receive: PartialFunction[Any, Unit] = {
    case _ =&gt; throw new SparkException(self + " does not implement 'receive'")
  }

  /**
   * Process messages from [[RpcEndpointRef.ask]]. If receiving a unmatched message,
   * [[SparkException]] will be thrown and sent to `onError`.
   */
  def receiveAndReply(context: RpcCallContext): PartialFunction[Any, Unit] = {
    case _ =&gt; context.sendFailure(new SparkException(self + " won't reply anything"))
  }
</code></pre> 
  <p>One&nbsp;<code>RpcCallContext</code>&nbsp;is provided for endpoint to separate endpoing logic from message network transport process. Providing function to reply result or send failure information:</p> 
  <ul> 
   <li>reply(response: Any) : reply one message</li> 
   <li>sendFailure(e: Throwable) : send failure</li> 
  </ul> 
  <p>Also a serious status callbacks are provided :</p> 
  <ul> 
   <li>onError</li> 
   <li>onConnected</li> 
   <li>onDisconnected</li> 
   <li>onNetworkError</li> 
   <li>onStart</li> 
   <li>onStop</li> 
   <li>stop</li> 
  </ul> 
  <h3><a href="https://github.com/neoremind/kraps-rpc#12-run-server" aria-hidden="true" class="anchor" id="user-content-12-run-server" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>1.2 Run server</h3> 
  <p>There are a couple of steps to create a RPC server which provide <code>HelloEndpoint</code> service.</p> 
  <ol> 
   <li>Create <code>RpcEnvServerConfig</code>, <code>RpcConf</code> is where you can specify some parameters for the server, will be discussed in the below section, <code>hello-server</code> is just a simple name, no real use later. Host and port must be specified. Note that if server cannot bind on the specified port, it will try to increase the port value by one and try next.</li> 
   <li>Create <code>RpcEnv</code> which launches the server via TCP socket at localhost on port 52345.</li> 
   <li>Create <code>HelloEndpoint</code> and setup it with an identifier of <code>hello-service</code>, the name is for client to call and route into the correct service.</li> 
   <li><code>awaitTermination</code> will block the thread and make server run without exiting JVM.</li> 
  </ol> 
  <pre><code>import net.neoremind.kraps.RpcConf
import net.neoremind.kraps.rpc._
import net.neoremind.kraps.rpc.netty.NettyRpcEnvFactory

object HelloworldServer {

  def main(args: Array[String]): Unit = {
    val config = RpcEnvServerConfig(new RpcConf(), "hello-server", "localhost", 52345)
    val rpcEnv: RpcEnv = NettyRpcEnvFactory.create(config)
    val helloEndpoint: RpcEndpoint = new HelloEndpoint(rpcEnv)
    rpcEnv.setupEndpoint("hello-service", helloEndpoint)
    rpcEnv.awaitTermination()
  }
}
</code></pre> 
  <h3><a href="https://github.com/neoremind/kraps-rpc#13-client-call" aria-hidden="true" class="anchor" id="user-content-13-client-call" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>1.3 Client call</h3> 
  <h4><a href="https://github.com/neoremind/kraps-rpc#131-asynchronous-invocation" aria-hidden="true" class="anchor" id="user-content-131-asynchronous-invocation" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>1.3.1 Asynchronous invocation</h4> 
  <p>Creating <code>RpcEnv</code> is the same as above, and here use <code>setupEndpointRef</code> to create a stub to call remote server at localhost on port 52345 and route to <code>hello-service</code>.</p> 
  <p><code>Future</code> is used here for asynchronous invocation.</p> 
  <pre><code>import net.neoremind.kraps.RpcConf
import net.neoremind.kraps.rpc.{RpcAddress, RpcEndpointRef, RpcEnv, RpcEnvClientConfig}
import net.neoremind.kraps.rpc.netty.NettyRpcEnvFactory
import scala.concurrent.{Await, Future}
import scala.concurrent.duration.Duration
import scala.concurrent.ExecutionContext.Implicits.global

object HelloworldClient {

  def main(args: Array[String]): Unit = {
    import scala.concurrent.ExecutionContext.Implicits.global
    val rpcConf = new RpcConf()
    val config = RpcEnvClientConfig(rpcConf, "hello-client")
    val rpcEnv: RpcEnv = NettyRpcEnvFactory.create(config)
    val endPointRef: RpcEndpointRef = rpcEnv.setupEndpointRef(RpcAddress("localhost", 52345), "hell-service")
    val future: Future[String] = endPointRef.ask[String](SayHi("neo"))
    future.onComplete {
      case scala.util.Success(value) =&gt; println(s"Got the result = $value")
      case scala.util.Failure(e) =&gt; println(s"Got error: $e")
    }
    Await.result(future, Duration.apply("30s"))
  }
}
</code></pre> 
  <h4><a href="https://github.com/neoremind/kraps-rpc#132-synchronous-invocation" aria-hidden="true" class="anchor" id="user-content-132-synchronous-invocation" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>1.3.2 Synchronous invocation</h4> 
  <p>Creating <code>RpcEnv</code> is the same as above, and here use <code>setupEndpointRef</code> to create a stub to call remote server at localhost on port 52345 and route to <code>hello-service</code>.</p> 
  <p>Use <code>askWithRetry</code> instead of <code>ask</code> to call in synchronous way.</p> 
  <p><em>Note that in latest Spark version the method signature has changed to <code>askSync</code>.</em></p> 
  <pre><code>object HelloworldClient {

  def main(args: Array[String]): Unit = {
    import scala.concurrent.ExecutionContext.Implicits.global
    val rpcConf = new RpcConf()
    val rpcConf = new RpcConf()
    val config = RpcEnvClientConfig(rpcConf, "hello-client")
    val rpcEnv: RpcEnv = NettyRpcEnvFactory.create(config)
    val endPointRef: RpcEndpointRef = rpcEnv.setupEndpointRef(RpcAddress("localhost", 52345), "hello-service")
    val result = endPointRef.askWithRetry[String](SayBye("neo"))
    println(result)
  }
}
</code></pre> 
  <h2><a href="https://github.com/neoremind/kraps-rpc#2-about-rpcconf" aria-hidden="true" class="anchor" id="user-content-2-about-rpcconf" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>2. About RpcConf</h2> 
  <p><code>RpcConf</code> is simply <code>SparkConf</code> in Spark, there are a couple of parameters that can be adjusted. They are listed below, for most of them you can reference to <a href="http://spark.apache.org/docs/2.1.0/configuration.html" target="_blank">Spark Configuration</a>. For example, you can specify parameter in the following way.</p> 
  <pre><code>val rpcConf = new RpcConf()
rpcConf.set("spark.rpc.lookupTimeout", "2s") 
</code></pre> 
  <p>The parameters can also be set in VM options like:</p> 
  <pre><code>-Dspark.rpc.netty.dispatcher.numThreads=16 -Dspark.rpc.io.threads=8
</code></pre> 
  <table> 
   <thead> 
    <tr> 
     <th>Configuration</th> 
     <th>Description</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <td>spark.rpc.lookupTimeout</td> 
     <td>Timeout to use for RPC remote endpoint lookup, whenever a call is made the client will always ask the server whether specific endpoint exists or not, this is for the asking timeout, default is 120s</td> 
    </tr> 
    <tr> 
     <td>spark.rpc.askTimeout</td> 
     <td>Timeout to use for RPC ask operations, default is 120s</td> 
    </tr> 
    <tr> 
     <td>spark.rpc.numRetries</td> 
     <td>Number of times to retry connecting, default is 3</td> 
    </tr> 
    <tr> 
     <td>spark.rpc.retry.wait</td> 
     <td>Number of milliseconds to wait on each retry, default is 3s</td> 
    </tr> 
    <tr> 
     <td>spark.rpc.io.numConnectionsPerPeer</td> 
     <td>Spark RPC maintains an array of clients and randomly picks one to use. Number of concurrent connections between two nodes for fetching data. For reusing, used on client side to build client pool, please always set to 1, default is 1.</td> 
    </tr> 
    <tr> 
     <td>spark.rpc.netty.dispatcher.numThreads</td> 
     <td>For server side, actor Inbox dispatcher thread pool size, it is where endpoint business logic runs, if endpoints stall and reach to this number, event new RPC messages can be accepted, but server can not handle them in endpoint due to the limit, default is 8.</td> 
    </tr> 
    <tr> 
     <td>spark.rpc.io.threads</td> 
     <td>For server and client side netty eventloop, this number is reactor thread pool size, the thread is responsible for accepting new connections and closing connections, serialize and deserialize byte array to RpcMessage object and push RpcMessage to actor pattern based Inbox for dispatcher to pick up and process, dispatcher concurrent level is set by<code>spark.rpc.netty.dispatcher.numThreads</code>. Default number is CPU cores * 2, min is 1.</td> 
    </tr>
   </tbody>
  </table> 
  <h2><a href="https://github.com/neoremind/kraps-rpc#3-more-examples" aria-hidden="true" class="anchor" id="user-content-3-more-examples" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>3. More examples</h2> 
  <p>Please find more in <a href="https://github.com/neoremind/kraps-rpc/blob/master/kraps-rpc/src/test/scala/com/neoremind/kraps/RpcTest.scala" target="_blank">test cases</a>.</p> 
  <h2><a href="https://github.com/neoremind/kraps-rpc#4-performance-test" aria-hidden="true" class="anchor" id="user-content-4-performance-test" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>4. Performance test</h2> 
  <h3><a href="https://github.com/neoremind/kraps-rpc#41-test-environment" aria-hidden="true" class="anchor" id="user-content-41-test-environment" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>4.1 Test environment</h3> 
  <p>One server and one client will be setup for testing at the same rack hosted in VM in different phasical machines. Test environment lists as below.</p> 
  <pre><code>CPU: Intel(R) Xeon(R) CPU E5-2620 v3 @ 2.40GHz 4 cores
Memory: 8G
OS: Linux ap-inf01 4.4.0-78-generic #99-Ubuntu SMP Thu Apr 27 15:29:09 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
JDK: 
OpenJDK Runtime Environment (build 1.8.0_131-8u131-b11-2ubuntu1.16.04.3-b11)
OpenJDK 64-Bit Server VM (build 25.131-b11, mixed mode)
</code></pre> 
  <h3><a href="https://github.com/neoremind/kraps-rpc#42-test-case" aria-hidden="true" class="anchor" id="user-content-42-test-case" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>4.2 Test case</h3> 
  <p>All performance related test cases can be found in <a href="https://github.com/neoremind/kraps-rpc/tree/master/kraps-rpc-example/src/main/scala" target="_blank">kraps-rpc-example</a>. Keep all parameters as default values.</p> 
  <p><a href="https://github.com/neoremind/kraps-rpc/blob/master/kraps-rpc-example/src/main/scala/HelloworldServer.scala" target="_blank">Click here</a> to see server test case. Server running command is</p> 
  <pre><code>java -server -Xms4096m -Xmx4096m -cp kraps-rpc-example_2.11-1.0.1-SNAPSHOT-jar-with-dependencies.jar HelloworldServer &lt;ip&gt;
</code></pre> 
  <p><a href="https://github.com/neoremind/kraps-rpc/blob/master/kraps-rpc-example/src/main/scala/PerformanceTestClient.scala" target="_blank">Click here</a> to see client test case. Client running command is</p> 
  <pre><code>java -server -Xms2048m -Xmx2048m -cp kraps-rpc-example_2.11-1.0.1-SNAPSHOT-jar-with-dependencies.jar PerformanceTestClient &lt;ip&gt; &lt;invocation number&gt; &lt;concurrent calls&gt;
</code></pre> 
  <h3><a href="https://github.com/neoremind/kraps-rpc#43-test-result" aria-hidden="true" class="anchor" id="user-content-43-test-result" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>4.3 Test result</h3> 
  <p>Peak QPS will reach to more than 18k as concurrent level goes up.</p> 
  <p><a href="https://github.com/neoremind/mydoc/blob/master/image/kraps_rpc_performance_QPS.png?raw=true" target="_blank"><img src="https://github.com/neoremind/mydoc/raw/master/image/kraps_rpc_performance_QPS.png?raw=true" alt="" style="max-width:100%;"></a></p> 
  <p>Below is CPU usage of server VM during the time performance tests are executed.</p> 
  <p><a href="https://github.com/neoremind/mydoc/blob/master/image/kraps_rpc_performance_test_server_cpu_usage.png?raw=true" target="_blank"><img src="https://github.com/neoremind/mydoc/raw/master/image/kraps_rpc_performance_test_server_cpu_usage.png?raw=true" alt="" style="max-width:100%;"></a></p> 
  <p>Below is CPU usage of client VM during the time performance tests are executed.</p> 
  <p><a href="https://github.com/neoremind/mydoc/blob/master/image/kraps_rpc_performance_test_client_cpu_usage.png?raw=true" target="_blank"><img src="https://github.com/neoremind/mydoc/raw/master/image/kraps_rpc_performance_test_client_cpu_usage.png?raw=true" alt="" style="max-width:100%;"></a></p> 
  <p>As shown above, during testing phase, server workload is not very high, I think there is still room for higher QPS if more concurrent client calls could be made.</p> 
  <h2><a href="https://github.com/neoremind/kraps-rpc#5-dependency-tree" aria-hidden="true" class="anchor" id="user-content-5-dependency-tree" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>5. Dependency tree</h2> 
  <pre><code>[INFO] +- org.apache.spark:spark-network-common_2.11:jar:2.1.0:compile
[INFO] |  +- io.netty:netty-all:jar:4.0.42.Final:compile
[INFO] |  +- org.apache.commons:commons-lang3:jar:3.5:compile
[INFO] |  +- org.fusesource.leveldbjni:leveldbjni-all:jar:1.8:compile
[INFO] |  +- com.fasterxml.jackson.core:jackson-databind:jar:2.6.5:compile
[INFO] |  +- com.fasterxml.jackson.core:jackson-annotations:jar:2.6.5:compile
[INFO] |  +- com.google.code.findbugs:jsr305:jar:1.3.9:compile
[INFO] |  +- org.apache.spark:spark-tags_2.11:jar:2.1.0:compile
[INFO] |  \- org.spark-project.spark:unused:jar:1.0.0:compile
[INFO] +- de.ruedigermoeller:fst:jar:2.50:compile
[INFO] |  +- com.fasterxml.jackson.core:jackson-core:jar:2.8.8:compile
[INFO] |  +- org.javassist:javassist:jar:3.21.0-GA:compile
[INFO] |  +- org.objenesis:objenesis:jar:2.5.1:compile
[INFO] |  \- com.cedarsoftware:java-util:jar:1.9.0:compile
[INFO] |     +- commons-logging:commons-logging:jar:1.1.1:compile
[INFO] |     \- com.cedarsoftware:json-io:jar:2.5.1:compile
[INFO] +- org.scala-lang:scala-library:jar:2.11.8:compile
[INFO] +- org.slf4j:slf4j-api:jar:1.7.7:compile
[INFO] +- org.slf4j:slf4j-log4j12:jar:1.7.7:compile
[INFO] |  \- log4j:log4j:jar:1.2.17:compile
[INFO] +- com.google.guava:guava:jar:15.0:compile
</code></pre> 
  <h2><a href="https://github.com/neoremind/kraps-rpc#6-acknowledgement" aria-hidden="true" class="anchor" id="user-content-6-acknowledgement" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>6. Acknowledgement</h2> 
  <p>The development of Kraps-rpc is inspired by Spark. Kraps-rpc with Apache2.0 Open Source License retains all copyright, trademark, authorâ€™s information from Spark.</p> 
 </article>
</div>