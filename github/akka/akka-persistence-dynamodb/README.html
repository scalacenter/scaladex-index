<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-dynamodbjournal-for-akka-persistence" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#dynamodbjournal-for-akka-persistence" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>DynamoDBJournal for Akka Persistence</h1> 
  <p>A replicated <a href="http://doc.akka.io/docs/akka/2.4.0/scala/persistence.html" target="_blank">Akka Persistence</a> journal backed by <a href="http://aws.amazon.com/dynamodb/" target="_blank">Amazon DynamoDB</a>.</p> 
  <ul> 
   <li>This plugin implements both a journal as well as a snapshot store,</li> 
   <li>Please note, however, that it does not include an Akka Persistence Query plugin.</li> 
  </ul> 
  <p>Supported versions:</p> 
  <ul> 
   <li>Scala: <code>2.11.x</code> or <code>2.12.x</code></li> 
   <li>Akka: <code>2.4.14+</code> and <code>2.5.x+</code> (see notes below how to use with 2.5)</li> 
   <li>Java: <code>1.8+</code></li> 
  </ul> 
  <p><a href="https://gitter.im/akka/akka-persistence-dynamodb?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank"><img src="https://camo.githubusercontent.com/969b0b1e2b83af211b78873a1f13c80b73c9a691/68747470733a2f2f6261646765732e6769747465722e696d2f616b6b612f616b6b612d70657273697374656e63652d64796e616d6f64622e737667" alt="Join the chat at https://gitter.im/akka/akka-persistence-dynamodb" data-canonical-src="https://badges.gitter.im/akka/akka-persistence-dynamodb.svg" style="max-width:100%;"></a> <a href="https://travis-ci.org/akka/akka-persistence-dynamodb" target="_blank"><img src="https://camo.githubusercontent.com/221e4ceae8db234fede7e77fcd7951346d93f2e4/68747470733a2f2f7472617669732d63692e6f72672f616b6b612f616b6b612d70657273697374656e63652d64796e616d6f64622e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/akka/akka-persistence-dynamodb.svg?branch=master" style="max-width:100%;"></a></p> 
  <h2><a id="user-content-installation" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#installation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installation</h2> 
  <p>This plugin is published to the Maven Central repository with the following names:</p> 
  <pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-persistence-dynamodb_2.11&lt;/artifactId&gt;
    &lt;version&gt;1.1.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre> 
  <p>or for sbt users:</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.typesafe.akka<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>akka-persistence-dynamodb<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>1.1.0<span class="pl-pds">"</span></span></pre>
  </div> 
  <h2><a id="user-content-configuration" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#configuration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Configuration</h2> 
  <h3><a id="user-content-journal" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#journal" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Journal</h3> 
  <pre><code>akka.persistence.journal.plugin = "my-dynamodb-journal"

my-dynamodb-journal = ${dynamodb-journal} # include the default settings
my-dynamodb-journal {                     # and add some overrides
    journal-table =  &lt;the name of the table to be used&gt;
    journal-name =  &lt;prefix to be used for all keys stored by this plugin&gt;
    aws-access-key-id =  &lt;your key&gt;
    aws-secret-access-key =  &lt;your secret&gt;
    endpoint =  "https://dynamodb.us-east-1.amazonaws.com" # or where your deployment is
}
</code></pre> 
  <p>For details on the endpoint URL please refer to the <a href="http://docs.aws.amazon.com/general/latest/gr/rande.html#ddb_region" target="_blank">DynamoDB documentation</a>. There are many more settings that can be used for fine-tuning and adapting this journal plugin to your use-case, please refer to the <a href="https://github.com/akka/akka-persistence-dynamodb/blob/master/src/main/resources/reference.conf" target="_blank">reference.conf</a> file.</p> 
  <p>Before you can use these settings you will have to create a table, e.g. using the AWS console, with the following schema:</p> 
  <ul> 
   <li>a hash key of type String with name <code>par</code></li> 
   <li>a sort key of type Number with name <code>num</code></li> 
  </ul> 
  <h3><a id="user-content-snapshot-store" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#snapshot-store" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Snapshot store</h3> 
  <p>(<strong>Since:</strong> <code>1.1.0</code>; contributed by <a href="https://github.com/joost-de-vries" target="_blank">@joost-de-vries</a>)</p> 
  <pre><code>akka.persistence.snapshot-store.plugin = "my-dynamodb-snapshot"

my-dynamodb-snapshot-store = ${dynamodb-snapshot-store} # include the default settings
my-dynamodb-snapshot-store {                     # and add some overrides
    snapshot-table =  &lt;the name of the table to be used&gt;
    journal-name =  &lt;prefix to be used for all keys stored by this plugin&gt;
    aws-access-key-id =  &lt;your key, default is the same as journal&gt;
    aws-secret-access-key =  &lt;your secret, default is the same as journal&gt;
    endpoint =  "https://dynamodb.us-east-1.amazonaws.com" # or where your deployment is, default is the same as journal
}
</code></pre> 
  <p>The table to create for snapshot storage has the schema:</p> 
  <ul> 
   <li>a hash key of type String with name <code>par</code></li> 
   <li>a sort key of type Number with name <code>seq</code></li> 
   <li>a sort key of type Number with name <code>ts</code></li> 
   <li>a local secondary index with name <code>ts-idx</code> that is an index on the combination of <code>par</code> and <code>ts</code></li> 
  </ul> 
  <p>The Dynamodb item of a snapshot <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Limits.html#limits-items" target="_blank">can be 400 kB</a>. Using a binary serialisation format like ProtoBuf or Kryo will use that space most effectively.</p> 
  <h2><a id="user-content-storage-semantics" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#storage-semantics" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Storage Semantics</h2> 
  <p>DynamoDB only offers consistency guarantees for a single storage item—which corresponds to one event in the case of this Akka Persistence plugin. This means that any single event is either written to the journal (and thereby visible to later replays) or it is not. This plugin supports atomic multi-event batches nevertheless, by marking the contained events such that partial replay can be avoided (see the <code>idx</code> and <code>cnt</code> attributes in the storage format description below). Consider the following actions of a PersistentActor:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">events</span> <span class="pl-k">=</span> <span class="pl-en">List</span>(&lt;<span class="pl-ent">some</span> events&gt;)
<span class="pl-k">if</span> (atomic) {
  persistAll(events)(handler)
<span class="pl-k">else</span> {
  <span class="pl-k">for</span> (event <span class="pl-k">&lt;</span><span class="pl-k">-</span> events) persist(event)(handler)
}</pre>
  </div> 
  <p>In the first case a recovery will only ever see all of the events or none of them. This is also true if recovery is requested with an upper limit on the sequence number to be recovered to or a limit on the number of events to be replayed; the event count limit is applied before removing incomplete batch writes which means that the actual count of events received at the actor may be lower than the requested limit even if further events are available.</p> 
  <p>In the second case each event is treated in isolation and may or may not be replayed depending on whether it was persisted successfully or not.</p> 
  <h2><a id="user-content-performance-considerations" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#performance-considerations" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Performance Considerations</h2> 
  <p>This plugin uses the AWS Java SDK which means that the number of requests that can be made concurrently is limited by the number of connections to DynamoDB and by the number of threads in the thread-pool that is used by the AWS HTTP client. The default setting is 50 connections which for a deployment that is used from the same EC2 region allows roughly 5000 requests per second (where every persisted event batch is roughly one request). If a single ActorSystem needs to persist more than this number of events per second then you may want to tune the parameter</p> 
  <pre><code>my-dynamodb-journal.aws-client-config.max-connections = &lt;your value here&gt;
</code></pre> 
  <p>Changing this number changes both the number of concurrent connections and the used thread-pool size.</p> 
  <h2><a id="user-content-compatibility-with-pre-10-versions" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#compatibility-with-pre-10-versions" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Compatibility with pre-1.0 versions</h2> 
  <p>The storage layout has been changed incompatibly for performance and correctness reasons, therefore events stored with the old plugin cannot be used with versions since 1.0.</p> 
  <h2><a id="user-content-plugin-development" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#plugin-development" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Plugin Development</h2> 
  <h3><a id="user-content-dev-setup" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#dev-setup" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Dev Setup</h3> 
  <ul> 
   <li>Run <code>./scripts/dev-setup.sh</code> to download and start <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Tools.DynamoDBLocal.html" target="_blank">DynamoDB-local</a>.</li> 
   <li>Now you are all set for running the test suite from <code>sbt</code>.</li> 
   <li>In order to stop the DynamoDB process you may execute <code>./scripts/kill-dynamoDB.sh</code>.</li> 
  </ul> 
  <p>Please also read the <a href="https://github.com/akka/akka-persistence-dynamodb/blob/master/CONTRIBUTING.md" target="_blank">CONTRIBUTING.md</a> file.</p> 
  <h3><a id="user-content-dynamodb-table-structure-discussion" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#dynamodb-table-structure-discussion" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>DynamoDB table structure discussion</h3> 
  <p>The structure for journal storage in dynamodb has evolved over iterations of performance tuning. Most of these lessons were learned in creating the eventsourced dynamodb journal, but apply here as well.</p> 
  <h5><a id="user-content-naïve-structure" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#naïve-structure" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Naïve structure</h5> 
  <p>When initially modelling journal storage in dynamo, it seems natural to use a simple structure similar to this</p> 
  <pre><code>persistenceId : S : HashKey
sequenceNr    : N : RangeKey
payload       : B
</code></pre> 
  <p>This maps very well to the operations a journal needs to solve.</p> 
  <pre><code>writeMessage      -&gt; PutItem
deleteMessage     -&gt; DeleteItem
replayMessages    -&gt; Query by persistenceId, conditions and ordered by sequenceNr, ascending
highCounter       -&gt; Query by persistenceId, conditions and ordered by sequenceNr, descending limit 1
</code></pre> 
  <p>However this layout suffers from scalability problems. Since the hash key is used to locate the data storage node, all writes for a single processor will go to the same DynamoDB node, which limits throughput and invites throttling, no matter the level of throughput provisioned for a table—the hash key just gets too hot. Also this limits replay throughput since you have to step through a sequence of queries, where you use the last processed item in query N for query N+1.</p> 
  <h5><a id="user-content-higher-throughput-structure" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#higher-throughput-structure" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Higher throughput structure</h5> 
  <p>With the following abbreviations:</p> 
  <pre><code>P -&gt; PersistentRepr
SH -&gt; SequenceHigh
SL -&gt; SequenceLow
</code></pre> 
  <p>we model PersistentRepr storage as</p> 
  <pre><code>par = &lt;journalName&gt;-P-&lt;persistenceId&gt;-&lt;sequenceNr / 100&gt; : S : HashKey
num = &lt;sequenceNr % 100&gt;                                 : N : RangeKey
pay = &lt;payload&gt;                                          : B
idx = &lt;atomic write batch index&gt;                         : N (possibly absent)
cnt = &lt;atomic write batch max index&gt;                     : N (possibly absent)
</code></pre> 
  <p>High Sequence Numbers</p> 
  <pre><code>par = &lt;journalName&gt;-SH-&lt;persistenceId&gt;-&lt;(sequenceNr / 100) % sequenceShards&gt; : S : HashKey
num = 0                                                                      : N : RangeKey
seq = &lt;sequenceNr rounded down to nearest multiple of 100&gt;                   : N
</code></pre> 
  <p>Low Sequence Numbers</p> 
  <pre><code>par = &lt;journalName&gt;-SL-&lt;persistenceId&gt;-&lt;(sequenceNr / 100) % sequenceShards&gt; : S : HashKey
num = 0                                                                      : N : RangeKey
seq = &lt;sequenceNr, not rounded&gt;                                              : N
</code></pre> 
  <p>This is somewhat more difficult to code, but offers higher throughput possibilities. Notice that the items that hold the high and low sequence are sharded, rather than using a single item to store the counter. If we only used a single item, we would suffer from the same hot key problems as our first structure.</p> 
  <p>When writing an item we typically do not touch the high sequence number storage, only when writing an item with sort key <code>0</code> is this done. This implies that reading the highest sequence number will need to first query the sequence shards for the highest multiple of 100 and then send a <code>Query</code> for the corresponding P entry’s hash key to find the highest stored sort key number.</p> 
  <h2><a id="user-content-using-with-akka-25x" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#using-with-akka-25x" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Using with Akka 2.5.x</h2> 
  <p>This plugin depends on Akka 2.4, however since <a href="http://doc.akka.io/docs/akka/current/scala/common/binary-compatibility-rules.html" target="_blank">Akka maintains strict backwards compatibility guarantees</a> across minor versions, it is completely compatible to use this plugin with Akka 2.5.x.</p> 
  <p>Please make sure to depend on all Akka artifacts (those with the artifact name begining with <code>akka-*</code>) are depended on in the same version - as mixing versions is <em>not</em> legal. For example, if you depend on Akka Persistence in <code>2.5.3</code>, make sure that Akka Streams and Actors are also depended on in the same version. Please always use the latest patch version available (!).</p> 
  <h2><a id="user-content-credits" class="anchor" href="https://github.com/akka/akka-persistence-dynamodb#credits" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Credits</h2> 
  <ul> 
   <li>Initial development was done by <a href="https://github.com/sclasen/akka-persistence-dynamodb" target="_blank">Scott Clasen</a>.</li> 
   <li>Update to Akka 2.4 and further development up to version 1.0 was kindly sponsored by <a href="https://www.zynga.com/" target="_blank">Zynga Inc.</a>.</li> 
   <li>The snapshot store was contributed by <a href="https://github.com/joost-de-vries" target="_blank">Joost de Vries</a></li> 
  </ul> 
 </article>
</div>