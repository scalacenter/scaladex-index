<div class="announce instapaper_body markdown" data-path="README.markdown" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-sjson-new" class="anchor" href="https://github.com/eed3si9n/sjson-new#sjson-new" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>sjson-new</h1> 
  <p>sjson-new is a typeclass based JSON codec, or wit for that <a href="https://github.com/non/jawn" target="_blank">Jawn</a>.</p> 
  <h3><a id="user-content-todays-random-philadelphia-word" class="anchor" href="https://github.com/eed3si9n/sjson-new#todays-random-philadelphia-word" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>today's random Philadelphia word</h3> 
  <p>The term <em>wit</em> comes from the Philadelphia area. It's a quick way of ordering a cheesesteak "with" sautéed onions.</p> 
  <h3><a id="user-content-overview" class="anchor" href="https://github.com/eed3si9n/sjson-new#overview" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>overview</h3> 
  <p>sjson-new consists of two parts:</p> 
  <ol> 
   <li>A typeclass-based JSON codec toolkit</li> 
   <li>Support packages which serialize to third-party ASTs</li> 
  </ol> 
  <h3><a id="user-content-installation" class="anchor" href="https://github.com/eed3si9n/sjson-new#installation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>installation</h3> 
  <p>sjson-new 0.5.x will be cross published for Scala 2.10, 2.11, and 2.12.</p> 
  <p>Here's how to use sjson-new with Spray:</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.eed3si9n<span class="pl-pds">"</span></span> <span class="pl-k">%%</span>  <span class="pl-s"><span class="pl-pds">"</span>sjson-new-spray<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.5.1<span class="pl-pds">"</span></span></pre>
  </div> 
  <p>Here's how to use sjson-new with Scala JSON:</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.eed3si9n<span class="pl-pds">"</span></span> <span class="pl-k">%%</span>  <span class="pl-s"><span class="pl-pds">"</span>sjson-new-scalajson<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.5.1<span class="pl-pds">"</span></span></pre>
  </div> 
  <p>Here's how to use sjson-new with MessagePack:</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.eed3si9n<span class="pl-pds">"</span></span> <span class="pl-k">%%</span>  <span class="pl-s"><span class="pl-pds">"</span>sjson-new-msgpack<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.5.1<span class="pl-pds">"</span></span></pre>
  </div> 
  <h3><a id="user-content-converting" class="anchor" href="https://github.com/eed3si9n/sjson-new#converting" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>converting</h3> 
  <p>sjson-new's converter let's you convert from an object of type <code>A</code> to and an AST of type <code>J</code>, given that you provide <code>JsonFormat[A]</code>.</p> 
  <p>This is an example of how you might use the converter into your code:</p> 
  <div class="highlight highlight-source-scala">
   <pre>scala<span class="pl-k">&gt;</span> <span class="pl-k">import</span> <span class="pl-v">sjsonnew.support.XYZ.</span><span class="pl-v">Converter</span>
<span class="pl-k">import</span> <span class="pl-v">sjsonnew.support.XYZ.</span><span class="pl-v">Converter</span>

scala<span class="pl-k">&gt;</span> <span class="pl-k">import</span> <span class="pl-v">sjsonnew.BasicJsonProtocol.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">sjsonnew.BasicJsonProtocol.</span><span class="pl-v">_</span>

scala<span class="pl-k">&gt;</span> <span class="pl-en">Converter</span>.toJson[<span class="pl-k">Int</span>](<span class="pl-c1">42</span>)
res0<span class="pl-k">:</span> scala.util.<span class="pl-en">Try</span>[<span class="pl-en">XYZ</span>.<span class="pl-en">JsValue</span>] <span class="pl-k">=</span> <span class="pl-en">Success</span>(<span class="pl-c1">42</span>)

scala<span class="pl-k">&gt;</span> <span class="pl-en">Converter</span>.fromJson[<span class="pl-k">Int</span>](res0.get)
res1<span class="pl-k">:</span> scala.util.<span class="pl-en">Try</span>[<span class="pl-k">Int</span>] <span class="pl-k">=</span> <span class="pl-en">Success</span>(<span class="pl-c1">42</span>)</pre>
  </div> 
  <p>In the above substitute <code>XYZ</code> with (<code>spray</code> | <code>scalajson.unsafe</code> | <code>msgpack</code>).</p> 
  <p>A <code>Converter</code> object provides the following functions for conversion:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">toJson</span>[<span class="pl-en">A</span>](<span class="pl-v">obj</span>: <span class="pl-en">A</span>)(<span class="pl-k">implicit</span> <span class="pl-v">writer</span>: <span class="pl-en">JsonWriter</span>[<span class="pl-en">A</span>])<span class="pl-k">:</span> <span class="pl-en">Try</span>[<span class="pl-en">J</span>]
<span class="pl-k">def</span> <span class="pl-en">toJsonUnsafe</span>[<span class="pl-en">A</span>](<span class="pl-v">obj</span>: <span class="pl-en">A</span>)(<span class="pl-k">implicit</span> <span class="pl-v">writer</span>: <span class="pl-en">JsonWriter</span>[<span class="pl-en">A</span>])<span class="pl-k">:</span> <span class="pl-en">J</span>
<span class="pl-k">def</span> <span class="pl-en">fromJson</span>[<span class="pl-en">A</span>](<span class="pl-v">js</span>: <span class="pl-en">J</span>)(<span class="pl-k">implicit</span> <span class="pl-v">reader</span>: <span class="pl-en">JsonReader</span>[<span class="pl-en">A</span>])<span class="pl-k">:</span> <span class="pl-en">Try</span>[<span class="pl-en">A</span>]
<span class="pl-k">def</span> <span class="pl-en">fromJsonUnsafe</span>[<span class="pl-en">A</span>](<span class="pl-v">js</span>: <span class="pl-en">J</span>)(<span class="pl-k">implicit</span> <span class="pl-v">reader</span>: <span class="pl-en">JsonReader</span>[<span class="pl-en">A</span>])<span class="pl-k">:</span> <span class="pl-en">A</span></pre>
  </div> 
  <h3><a id="user-content-dependencies" class="anchor" href="https://github.com/eed3si9n/sjson-new#dependencies" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>dependencies</h3> 
  <ul> 
   <li><code>sjson-new-core</code> has not dependencies other than Scala.</li> 
   <li>The support libraries (e.g. <code>sjon-new-spray</code>) depend on the corresponding ASTs they are supporting.</li> 
  </ul> 
  <h3><a id="user-content-jsonprotocol" class="anchor" href="https://github.com/eed3si9n/sjson-new#jsonprotocol" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>JsonProtocol</h3> 
  <p>sjson-new uses <a href="https://github.com/debasishg/sjson" target="_blank">sjson</a>'s Scala-idiomatic typeclass-based approach to connect an existing type <code>A</code> with the logic how to (de)serialize its instances to and from JSON. This notion was further extended by <a href="https://github.com/spray/spray-json" target="_blank">spray-json</a>, and sjson-new reuses some of both <a href="https://github.com/debasishg/sjson" target="_blank">sjson</a> and <a href="https://github.com/spray/spray-json" target="_blank">spray-json</a>'s code, see the 'Credits' section below.</p> 
  <p>While the typeclass in the original <a href="https://github.com/debasishg/sjson" target="_blank">sjson</a> directly manipulates the JSON AST, sjon-new adds an indirection mechanism, which allows it to be backend-independent. This machinary is inspired both by <a href="https://github.com/non/jawn" target="_blank">Jawn</a> and <a href="https://github.com/scala/pickling" target="_blank">Scala Pickling</a>. This wire protocol indirection is called <em>façade</em> in Jawn, and "format" in Pickling. sjson-new will also call this <em>façade</em> to avoid the mixup.</p> 
  <p>The typeclass approach has the advantage of not requiring any change (or even access) to <code>A</code>s source code. All (de)serialization logic is attached <em>from the outside</em>. There is no reflection involved, so the resulting conversions are fast. Scalas excellent type inference reduces verbosity and boilerplate to a minimum, while the Scala compiler will make sure at compile time that you provided all required (de)serialization logic.</p> 
  <p>In sjson-new's terminology a <em>JSON protocol</em> is nothing but a bunch of implicit values of type <code>JsonFormat[A]</code>, whereby each <code>JsonFormat[A]</code> contains the logic of how to convert instance of <code>A</code> to and from JSON. All <code>JsonFormat[A]</code>s of a protocol need to be "mece" (mutually exclusive, collectively exhaustive), i.e. they are not allowed to overlap and together need to span all types required by the application.</p> 
  <p>This may sound more complicated than it is. sjon-new comes with a <code>BasicJsonProtocol</code>, which already covers all of Scala's value types as well as the most important reference and collection types. As long as your code uses nothing more than these you only need the <code>BasicJsonProtocol</code>. Here are the types already taken care of by the <code>BasicJsonProtocol</code>:</p> 
  <ul> 
   <li>Byte, Short, Int, Long, Float, Double, Char, Unit, Boolean</li> 
   <li>String, Symbol</li> 
   <li>BigInt, BigDecimal</li> 
   <li>Option, Either, Tuple1 - Tuple22</li> 
   <li>List, Array</li> 
   <li>immutable.{Map, Iterable, Seq, IndexedSeq, LinearSeq, Set, Vector}</li> 
   <li>collection.{Iterable, Seq, IndexedSeq, LinearSeq, Set}</li> 
   <li>LList</li> 
  </ul> 
  <h3><a id="user-content-llist" class="anchor" href="https://github.com/eed3si9n/sjson-new#llist" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>LList</h3> 
  <p>sjson-new comes with a datatype called <strong>LList</strong>, which stands for labelled heterogeneous list. <code>List[A]</code> that comes with the Standard Library can only store values of one type <code>A</code>. Unlike the standard <code>List[A]</code>, LList can store values of different types per cell, and it can also store a label per cell. Because of this reason, each LList has its own type. Here's how it looks in the REPL:</p> 
  <div class="highlight highlight-source-scala">
   <pre>scala<span class="pl-k">&gt;</span> <span class="pl-k">import</span> <span class="pl-v">sjsonnew.</span><span class="pl-v">_, </span><span class="pl-v">LList.</span><span class="pl-v">:*:</span>
<span class="pl-k">import</span> <span class="pl-v">sjsonnew.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">LList.</span><span class="pl-v">$colon$plus$colon</span>

scala<span class="pl-k">&gt;</span> <span class="pl-k">import</span> <span class="pl-v">BasicJsonProtocol.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">BasicJsonProtocol.</span><span class="pl-v">_</span>

scala<span class="pl-k">&gt;</span> <span class="pl-k">val</span> <span class="pl-en">x</span> <span class="pl-k">=</span> (<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span>) <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> (<span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>, <span class="pl-c1">1</span>) <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> <span class="pl-en">LNil</span>
x<span class="pl-k">:</span> sjsonnew.<span class="pl-en">LList</span>.<span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span>[<span class="pl-k">String</span>,sjsonnew.<span class="pl-en">LList</span>.<span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span>[<span class="pl-k">Int</span>,sjsonnew.<span class="pl-en">LNil</span>]] <span class="pl-k">=</span> (name, <span class="pl-en">A</span>) <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> (value, <span class="pl-c1">1</span>) <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> <span class="pl-en">LNil</span>

scala<span class="pl-k">&gt;</span> <span class="pl-k">val</span> <span class="pl-en">y</span><span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> <span class="pl-k">Int</span> <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> <span class="pl-en">LNil</span> <span class="pl-k">=</span> x
y<span class="pl-k">:</span> sjsonnew.<span class="pl-en">LList</span>.<span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span>[<span class="pl-k">String</span>,sjsonnew.<span class="pl-en">LList</span>.<span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span>[<span class="pl-k">Int</span>,sjsonnew.<span class="pl-en">LNil</span>]] <span class="pl-k">=</span> (name, <span class="pl-en">A</span>) <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> (value, <span class="pl-c1">1</span>) <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> <span class="pl-en">LNil</span></pre>
  </div> 
  <p><code>BasicJsonProtocol</code> is able to convert all LList values into a JSON object.</p> 
  <h3><a id="user-content-custom-types" class="anchor" href="https://github.com/eed3si9n/sjson-new#custom-types" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Custom types</h3> 
  <p>In most cases however you'll also want to convert types not covered by the <code>BasicJsonProtocol</code>. In these cases you need to provide <code>JsonFormat[A]</code>s for your custom types</p> 
  <p>All you have to do is provide an isomorphism between your types and an LList using <code>LList.iso</code> function.</p> 
  <div class="highlight highlight-source-scala">
   <pre>scala<span class="pl-k">&gt;</span> <span class="pl-k">import</span> <span class="pl-v">sjsonnew.</span><span class="pl-v">_, </span><span class="pl-v">LList.</span><span class="pl-v">:*:</span>
<span class="pl-k">import</span> <span class="pl-v">sjsonnew.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">LList.</span><span class="pl-v">$colon$plus$colon</span>

scala<span class="pl-k">&gt;</span> <span class="pl-k">import</span> <span class="pl-v">BasicJsonProtocol.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">BasicJsonProtocol.</span><span class="pl-v">_</span>

scala<span class="pl-k">&gt;</span> <span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Person</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span>, <span class="pl-v">value</span>: <span class="pl-k">Int</span>)
defined <span class="pl-k">class</span> <span class="pl-en">Person</span>

scala<span class="pl-k">&gt;</span> <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">personIso</span> <span class="pl-k">=</span> <span class="pl-en">LList</span>.iso(
         { <span class="pl-v">p</span>: <span class="pl-en">Person</span> <span class="pl-k">=&gt;</span> (<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, p.name) <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> (<span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>, p.value) <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> <span class="pl-en">LNil</span> },
         { <span class="pl-v">in</span>: <span class="pl-k">String</span> <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> <span class="pl-k">Int</span> <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> <span class="pl-en">LNil</span> <span class="pl-k">=&gt;</span> <span class="pl-en">Person</span>(in.head, in.tail.head) })
personIso<span class="pl-k">:</span> sjsonnew.<span class="pl-en">IsoLList</span>.<span class="pl-en">Aux</span>[<span class="pl-en">Person</span>,sjsonnew.<span class="pl-en">LList</span>.<span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span>[<span class="pl-k">String</span>,sjsonnew.<span class="pl-en">LList</span>.<span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span>[<span class="pl-k">Int</span>,sjsonnew.<span class="pl-en">LNil</span>]]] <span class="pl-k">=</span> sjsonnew.<span class="pl-en">IsoLList</span>$$anon$<span class="pl-c1">1</span><span class="pl-k">@</span>4140e9d0

scala<span class="pl-k">&gt;</span> <span class="pl-k">import</span> <span class="pl-v">sjsonnew.support.spray.</span><span class="pl-v">Converter</span>
<span class="pl-k">import</span> <span class="pl-v">sjsonnew.support.spray.</span><span class="pl-v">Converter</span>

scala<span class="pl-k">&gt;</span> <span class="pl-en">Converter</span>.toJson[<span class="pl-en">Person</span>](<span class="pl-en">Person</span>(<span class="pl-s"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span>, <span class="pl-c1">1</span>))
res0<span class="pl-k">:</span> scala.util.<span class="pl-en">Try</span>[spray.json.<span class="pl-en">JsValue</span>] <span class="pl-k">=</span> <span class="pl-en">Success</span>({<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span><span class="pl-k">:</span><span class="pl-c1">1</span>})</pre>
  </div> 
  <p>Using <code>personIso</code>, sjson-new derived the <code>JsonFomrat</code> for <code>Person</code>.</p> 
  <p>Suppose now that we have an algebraic datatype (ADT) represented by a sealed trait. There's a function to compose the <code>JsonFormat</code> called <code>unionFormat2</code>, <code>unionFormat3</code>, ...</p> 
  <div class="highlight highlight-source-scala">
   <pre>scala<span class="pl-k">&gt;</span> <span class="pl-k">import</span> <span class="pl-v">sjsonnew.</span><span class="pl-v">_, </span><span class="pl-v">LList.</span><span class="pl-v">:*:</span>
<span class="pl-k">import</span> <span class="pl-v">sjsonnew.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">LList.</span><span class="pl-v">$colon$plus$colon</span>

scala<span class="pl-k">&gt;</span> <span class="pl-k">import</span> <span class="pl-v">BasicJsonProtocol.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">BasicJsonProtocol.</span><span class="pl-v">_</span>

scala<span class="pl-k">&gt;</span> <span class="pl-k">:</span>paste
<span class="pl-c">// Entering paste mode (ctrl-D to finish)</span>

<span class="pl-k">sealed</span> <span class="pl-k">trait</span> <span class="pl-en">Contact</span>
<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Person</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span>, <span class="pl-v">value</span>: <span class="pl-k">Int</span>) <span class="pl-k">extends</span> <span class="pl-e">Contact</span>
<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Organization</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span>, <span class="pl-v">value</span>: <span class="pl-k">Int</span>) <span class="pl-k">extends</span> <span class="pl-e">Contact</span>

<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">personIso</span> <span class="pl-k">=</span> <span class="pl-en">LList</span>.iso(
  { <span class="pl-v">p</span>: <span class="pl-en">Person</span> <span class="pl-k">=&gt;</span> (<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, p.name) <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> (<span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>, p.value) <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> <span class="pl-en">LNil</span> },
  { <span class="pl-v">in</span>: <span class="pl-k">String</span> <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> <span class="pl-k">Int</span> <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> <span class="pl-en">LNil</span> <span class="pl-k">=&gt;</span> <span class="pl-en">Person</span>(in.head, in.tail.head) })
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">organizationIso</span> <span class="pl-k">=</span> <span class="pl-en">LList</span>.iso(
  { <span class="pl-v">o</span>: <span class="pl-en">Organization</span> <span class="pl-k">=&gt;</span> (<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, o.name) <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> (<span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>, o.value) <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> <span class="pl-en">LNil</span> },
  { <span class="pl-v">in</span>: <span class="pl-k">String</span> <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> <span class="pl-k">Int</span> <span class="pl-k">:</span><span class="pl-k">*</span><span class="pl-k">:</span> <span class="pl-en">LNil</span> <span class="pl-k">=&gt;</span> <span class="pl-en">Organization</span>(in.head, in.tail.head) })
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">ContactFormat</span> <span class="pl-k">=</span> flatUnionFormat2[<span class="pl-en">Contact</span>, <span class="pl-en">Person</span>, <span class="pl-en">Organization</span>](<span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>)

<span class="pl-c">// Exiting paste mode, now interpreting.</span>

scala<span class="pl-k">&gt;</span> <span class="pl-k">import</span> <span class="pl-v">sjsonnew.support.spray.</span><span class="pl-v">Converter</span>
<span class="pl-k">import</span> <span class="pl-v">sjsonnew.support.spray.</span><span class="pl-v">Converter</span>

scala<span class="pl-k">&gt;</span> <span class="pl-en">Converter</span>.toJson[<span class="pl-en">Contact</span>](<span class="pl-en">Organization</span>(<span class="pl-s"><span class="pl-pds">"</span>Company<span class="pl-pds">"</span></span>, <span class="pl-c1">2</span>))
res0<span class="pl-k">:</span> scala.util.<span class="pl-en">Try</span>[spray.json.<span class="pl-en">JsValue</span>] <span class="pl-k">=</span> <span class="pl-en">Success</span>({<span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>Organization<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>Company<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span><span class="pl-k">:</span><span class="pl-c1">2</span>})</pre>
  </div> 
  <p>The <code>flatUnionFormatN[U, A1, A2, ...]("type")</code> functions assume that type <code>U</code> is the sealed parent trait of the type parameters <code>A1</code>, <code>A2, and encodes them by putting the simple type name (just the class name portion) into the specified</code>type` field along side the value fields as:</p> 
  <pre><code>{"type":"Organization","name":"Company","value":2}
</code></pre> 
  <p>On the other hand, the <code>unionFormatN[U, A1, A2, ...]</code> functions encodes them by putting the simple type name into <code>type</code> field, and the value in the <code>value</code> field:</p> 
  <pre><code>{"value":{"name":"Company","value":2},"type":"Organization"}
</code></pre> 
  <p><strong>BEWARE</strong>: Both <code>unionFormatN</code> and <code>flatUnionFormatN</code> functions only support leaf types in <code>A1</code>, <code>A2</code>, etc, so if your ADT consists of multiple levels of traits, you need to expand them yourself to a flat list of concrete types.</p> 
  <h3><a id="user-content-low-level-api-builder-and-unbuilder" class="anchor" href="https://github.com/eed3si9n/sjson-new#low-level-api-builder-and-unbuilder" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Low-level API: Builder and Unbuilder</h3> 
  <p>If you want to drop down to a more lower level JSON writing, for example, to encode something as JString, sjon-new offers Builder and Unbuilder. This is a procedural style API, and it's closer to the AST. For instance, <code>IntJsonFormat</code> is defined as follows:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">implicit</span> <span class="pl-k">object</span> <span class="pl-en">IntJsonFormat</span> <span class="pl-k">extends</span> <span class="pl-e">JsonFormat</span>[<span class="pl-k">Int</span>] {
  <span class="pl-k">def</span> <span class="pl-en">write</span>[<span class="pl-en">J</span>](<span class="pl-v">x</span>: <span class="pl-k">Int</span>, <span class="pl-v">builder</span>: <span class="pl-en">Builder</span>[<span class="pl-en">J</span>])<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span>
    builder.writeInt(x)
  <span class="pl-k">def</span> <span class="pl-en">read</span>[<span class="pl-en">J</span>](<span class="pl-v">jsOpt</span>: <span class="pl-en">Option</span>[<span class="pl-en">J</span>], <span class="pl-v">unbuilder</span>: <span class="pl-en">Unbuilder</span>[<span class="pl-en">J</span>])<span class="pl-k">:</span> <span class="pl-k">Int</span> <span class="pl-k">=</span>
    jsOpt <span class="pl-k">match</span> {
      <span class="pl-k">case</span> <span class="pl-en">Some</span>(js) <span class="pl-k">=&gt;</span> unbuilder.readInt(js)
      <span class="pl-k">case</span> <span class="pl-c1">None</span>     <span class="pl-k">=&gt;</span> <span class="pl-c1">0</span>
    }
}</pre>
  </div> 
  <p><code>Builder</code> provides other <code>writeX</code> methods to write primitive values. <code>Unbuilder</code> on the other hand provides <code>readX</code> methods.</p> 
  <p><code>BasicJsonProtocol</code> already provides encoding for standard collections like <code>List[A]</code>, but you might want to encode your own type using JSON array. To write a JSON array, use <code>beginArray()</code>, <code>writeX</code> methods, and <code>endArray()</code>. The builder internally tracks the states, so it won't let you end an array if you haven't started one.</p> 
  <p>To write a JSON object, you can use the LList isomorphism as described above, or use <code>beginObject()</code>, <code>addField("name", x)</code> method, and <code>endObject()</code>. Here's an example codec of the same case class <code>Person</code> using Builder/Unbuilder:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">implicit</span> <span class="pl-k">object</span> <span class="pl-en">PersonFormat</span> <span class="pl-k">extends</span> <span class="pl-e">JsonFormat</span>[<span class="pl-en">Person</span>] {
  <span class="pl-k">def</span> <span class="pl-en">write</span>[<span class="pl-en">J</span>](<span class="pl-v">x</span>: <span class="pl-en">Person</span>, <span class="pl-v">builder</span>: <span class="pl-en">Builder</span>[<span class="pl-en">J</span>])<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> {
    builder.beginObject()
    builder.addField(<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, x.name)
    builder.addField(<span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>, x.value)
    builder.endObject()
  }
  <span class="pl-k">def</span> <span class="pl-en">read</span>[<span class="pl-en">J</span>](<span class="pl-v">jsOpt</span>: <span class="pl-en">Option</span>[<span class="pl-en">J</span>], <span class="pl-v">unbuilder</span>: <span class="pl-en">Unbuilder</span>[<span class="pl-en">J</span>])<span class="pl-k">:</span> <span class="pl-en">Person</span> <span class="pl-k">=</span>
    jsOpt <span class="pl-k">match</span> {
      <span class="pl-k">case</span> <span class="pl-en">Some</span>(js) <span class="pl-k">=&gt;</span>
        unbuilder.beginObject(js)
        <span class="pl-k">val</span> <span class="pl-en">name</span> <span class="pl-k">=</span> unbuilder.readField[<span class="pl-k">String</span>](<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>)
        <span class="pl-k">val</span> <span class="pl-en">value</span> <span class="pl-k">=</span> unbuilder.readField[<span class="pl-k">Int</span>](<span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>)
        unbuilder.endObject()
        <span class="pl-en">Person</span>(name, value)
      <span class="pl-k">case</span> <span class="pl-c1">None</span> <span class="pl-k">=&gt;</span>
        deserializationError(<span class="pl-s"><span class="pl-pds">"</span>Expected JsObject but found None<span class="pl-pds">"</span></span>)
    }
}</pre>
  </div> 
  <p>The other one was three lines of iso, but this is 25 lines of code. Since it doesn't create LList, it might run faster.</p> 
  <h3><a id="user-content-credits" class="anchor" href="https://github.com/eed3si9n/sjson-new#credits" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Credits</h3> 
  <ul> 
   <li>In 2010 <strong>Debasish Ghosh</strong> (<a href="https://github.com/debasishg/" target="_blank">@debasishg</a>) wrote series of blog articles on typeclasses (<a href="http://debasishg.blogspot.com/2010/06/scala-implicits-type-classes-here-i.html" target="_blank">Scala Implicits : Type Classes Here I Come </a> etc), and implemented typeclass-based JSON serialization in <a href="https://github.com/debasishg/sjson" target="_blank">sjson</a>. sjson used JSON AST from Dispatch classic, which was contributed by Jorge Ortiz.</li> 
   <li>In 2011 <strong>Mathias</strong> (<a href="https://github.com/sirthias/" target="_blank">@sirthias</a>) created <a href="https://github.com/spray/spray-json" target="_blank">spray-json</a> project, combining sjson's serialization code and JSON AST from Dispatch classic, along with PEG-based parser. Honoring sjson, serialization code bares Debasish's copyright.</li> 
   <li>Around 2012 to 2014 <strong>Erik Osheim</strong> (<a href="https://github.com/non/" target="_blank">@non</a>) wrote <a href="https://github.com/non/jawn" target="_blank">Jawn</a>, a backend generic JSON parser. Jawn's facade code is used in sjson-new with further extension.</li> 
   <li>In 2013 <strong>Heather Miller</strong>, <strong>Philipp Haller</strong>, and <strong>Eugene Burmako</strong> published <a href="http://infoscience.epfl.ch/record/187787/files/oopsla-pickling_1.pdf" target="_blank">Instant Pickles: Generating Object-Oriented Pickler Combinators for Fast and Extensible Serialization</a>, and wrote <a href="https://github.com/scala/pickling" target="_blank">Scala Pickling</a>, which also provides wire format genericity.</li> 
  </ul> 
  <h3><a id="user-content-license" class="anchor" href="https://github.com/eed3si9n/sjson-new#license" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>License</h3> 
  <p>sjson-new is licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">APL 2.0</a>.</p> 
  <h3><a id="user-content-patch-policy" class="anchor" href="https://github.com/eed3si9n/sjson-new#patch-policy" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Patch Policy</h3> 
  <p>Feedback and contributions to the project, no matter what kind, are always very welcome. However, patches can only be accepted from their original author. Along with any patches, please state that the patch is your original work and that you license the work to the sjon-new project under the project’s open source license.</p> 
 </article>
</div>